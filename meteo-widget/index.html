
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../meteo/">
      
      
        <link rel="next" href="../meteo-widget-client/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.26">
    
    
      
        <title>Créer une fenêtre (Part 2) - A.V.A.T.A.R</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.6543a935.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      
  
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
  
  <style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M64 32C28.7 32 0 60.7 0 96v320c0 35.3 28.7 64 64 64h224V368c0-26.5 21.5-48 48-48h112V96c0-35.3-28.7-64-64-64H64zm384 320H336c-8.8 0-16 7.2-16 16v112l32-32 64-64 32-32z"/></svg>');--md-admonition-icon--abstract:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M96 0C43 0 0 43 0 96v320c0 53 43 96 96 96h320c17.7 0 32-14.3 32-32s-14.3-32-32-32v-64c17.7 0 32-14.3 32-32V32c0-17.7-14.3-32-32-32H96zm0 384h256v64H96c-17.7 0-32-14.3-32-32s14.3-32 32-32zm32-240c0-8.8 7.2-16 16-16h192c8.8 0 16 7.2 16 16s-7.2 16-16 16H144c-8.8 0-16-7.2-16-16zm16 48h192c8.8 0 16 7.2 16 16s-7.2 16-16 16H144c-8.8 0-16-7.2-16-16s7.2-16 16-16z"/></svg>');--md-admonition-icon--info:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M256 512a256 256 0 1 0 0-512 256 256 0 1 0 0 512zm-40-176h24v-64h-24c-13.3 0-24-10.7-24-24s10.7-24 24-24h48c13.3 0 24 10.7 24 24v88h8c13.3 0 24 10.7 24 24s-10.7 24-24 24h-80c-13.3 0-24-10.7-24-24s10.7-24 24-24zm40-208a32 32 0 1 1 0 64 32 32 0 1 1 0-64z"/></svg>');--md-admonition-icon--tip:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M480 32c0-12.9-7.8-24.6-19.8-29.6S434.5.2 425.3 9.3L381.7 53c-48 48-113.1 75-181 75H64c-35.3 0-64 28.7-64 64v96c0 35.3 28.7 64 64 64v128c0 17.7 14.3 32 32 32h64c17.7 0 32-14.3 32-32V352h8.7c67.9 0 133 27 181 75l43.6 43.6c9.2 9.2 22.9 11.9 34.9 6.9s19.8-16.6 19.8-29.6V300.4c18.6-8.8 32-32.5 32-60.4s-13.4-51.6-32-60.4V32zm-64 76.7v262.6C357.2 317.8 280.5 288 200.7 288H192v-96h8.7c79.8 0 156.5-29.8 215.3-83.3z"/></svg>');--md-admonition-icon--success:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7l233.4-233.3c12.5-12.5 32.8-12.5 45.3 0z"/></svg>');--md-admonition-icon--question:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M256 512a256 256 0 1 0 0-512 256 256 0 1 0 0 512zm-86.2-346.7c7.9-22.3 29.1-37.3 52.8-37.3h58.3c34.9 0 63.1 28.3 63.1 63.1 0 22.6-12.1 43.5-31.7 54.8L280 264.4c-.2 13-10.9 23.6-24 23.6-13.3 0-24-10.7-24-24v-13.5c0-8.6 4.6-16.5 12.1-20.8l44.3-25.4c4.7-2.7 7.6-7.7 7.6-13.1 0-8.4-6.8-15.1-15.1-15.1h-58.3c-3.4 0-6.4 2.1-7.5 5.3l-.4 1.2c-4.4 12.5-18.2 19-30.6 14.6s-19-18.2-14.6-30.6l.4-1.2zM224 352a32 32 0 1 1 64 0 32 32 0 1 1-64 0z"/></svg>');--md-admonition-icon--warning:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M256 32c14.2 0 27.3 7.5 34.5 19.8l216 368c7.3 12.4 7.3 27.7.2 40.1S486.3 480 472 480H40c-14.3 0-27.6-7.7-34.7-20.1s-7-27.8.2-40.1l216-368C228.7 39.5 241.8 32 256 32zm0 128c-13.3 0-24 10.7-24 24v112c0 13.3 10.7 24 24 24s24-10.7 24-24V184c0-13.3-10.7-24-24-24zm32 224a32 32 0 1 0-64 0 32 32 0 1 0 64 0z"/></svg>');--md-admonition-icon--failure:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M459.1 52.4 442.6 6.5c-1.9-3.9-6.1-6.5-10.5-6.5s-8.5 2.6-10.4 6.5l-16.5 45.9-46 16.8c-4.3 1.6-7.3 5.9-7.2 10.4 0 4.5 3 8.7 7.2 10.2l45.7 16.8 16.8 45.8c1.5 4.4 5.8 7.5 10.4 7.5s8.9-3.1 10.4-7.5l16.5-45.8 45.7-16.8c4.2-1.5 7.2-5.7 7.2-10.2 0-4.6-3-8.9-7.2-10.4l-45.6-16.8zm-132.4 53c-12.5-12.5-32.8-12.5-45.3 0l-2.9 2.9c-22-8-45.8-12.3-70.5-12.3C93.1 96 0 189.1 0 304s93.1 208 208 208 208-93.1 208-208c0-24.7-4.3-48.5-12.2-70.5l2.9-2.9c12.5-12.5 12.5-32.8 0-45.3l-80-80zM200 192c-57.4 0-104 46.6-104 104v8c0 8.8-7.2 16-16 16s-16-7.2-16-16v-8c0-75.1 60.9-136 136-136h8c8.8 0 16 7.2 16 16s-7.2 16-16 16h-8z"/></svg>');--md-admonition-icon--danger:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 398.9c58.5-41.1 96-104.1 96-174.9C512 100.3 397.4 0 256 0S0 100.3 0 224c0 70.7 37.5 133.8 96 174.9V464c0 26.5 21.5 48 48 48h48v-48c0-8.8 7.2-16 16-16s16 7.2 16 16v48h64v-48c0-8.8 7.2-16 16-16s16 7.2 16 16v48h48c26.5 0 48-21.5 48-48v-65.1zM96 256a64 64 0 1 1 128 0 64 64 0 1 1-128 0zm256-64a64 64 0 1 1 0 128 64 64 0 1 1 0-128z"/></svg>');--md-admonition-icon--bug:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M320 0c17.7 0 32 14.3 32 32v64h120c39.8 0 72 32.2 72 72v272c0 39.8-32.2 72-72 72H168c-39.8 0-72-32.2-72-72V168c0-39.8 32.2-72 72-72h120V32c0-17.7 14.3-32 32-32zM208 384c-8.8 0-16 7.2-16 16s7.2 16 16 16h32c8.8 0 16-7.2 16-16s-7.2-16-16-16h-32zm96 0c-8.8 0-16 7.2-16 16s7.2 16 16 16h32c8.8 0 16-7.2 16-16s-7.2-16-16-16h-32zm96 0c-8.8 0-16 7.2-16 16s7.2 16 16 16h32c8.8 0 16-7.2 16-16s-7.2-16-16-16h-32zM264 256a40 40 0 1 0-80 0 40 40 0 1 0 80 0zm152 40a40 40 0 1 0 0-80 40 40 0 1 0 0 80zM48 224h16v192H48c-26.5 0-48-21.5-48-48v-96c0-26.5 21.5-48 48-48zm544 0c26.5 0 48 21.5 48 48v96c0 26.5-21.5 48-48 48h-16V224h16z"/></svg>');--md-admonition-icon--example:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M288 0H128c-17.7 0-32 14.3-32 32s14.3 32 32 32v132.8c0 11.8-3.3 23.5-9.5 33.5L10.3 406.2C3.6 417.2 0 429.7 0 442.6 0 480.9 31.1 512 69.4 512h309.2c38.3 0 69.4-31.1 69.4-69.4 0-12.8-3.6-25.4-10.3-36.4L329.5 230.4c-6.2-10.1-9.5-21.7-9.5-33.5V64c17.7 0 32-14.3 32-32S337.7 0 320 0h-32zm-96 196.8V64h64v132.8c0 23.7 6.6 46.9 19 67.1l34.5 56.1h-171l34.5-56.1c12.4-20.2 19-43.4 19-67.1z"/></svg>');--md-admonition-icon--quote:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M0 216C0 149.7 53.7 96 120 96h8c17.7 0 32 14.3 32 32s-14.3 32-32 32h-8c-30.9 0-56 25.1-56 56v8h64c35.3 0 64 28.7 64 64v64c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V216zm256 0c0-66.3 53.7-120 120-120h8c17.7 0 32 14.3 32 32s-14.3 32-32 32h-8c-30.9 0-56 25.1-56 56v8h64c35.3 0 64 28.7 64 64v64c0 35.3-28.7 64-64 64h-64c-35.3 0-64-28.7-64-64V216z"/></svg>');}</style>


  
  
  
  
  <style>:root{--md-annotation-icon:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 20c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8m0-18A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10A10 10 0 0 0 12 2m1 5h-2v4H7v2h4v4h2v-4h4v-2h-4V7Z"/></svg>');}</style>


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="dark" data-md-color-primary="blue-grey" data-md-color-accent="purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#weather-forecast-part-2" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="A.V.A.T.A.R" class="md-header__button md-logo" aria-label="A.V.A.T.A.R" data-md-component="logo">
      
  <img src="../img/Avatar.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            A.V.A.T.A.R
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Créer une fenêtre (Part 2)
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="dark" data-md-color-primary="blue-grey" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4m0-7c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="blue-grey" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../introduction/" class="md-tabs__link">
          
  
  Installation

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../getting-started/" class="md-tabs__link">
          
  
  Getting started

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../developer-guide/" class="md-tabs__link">
          
  
  Developer Guide

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../about/" class="md-tabs__link">
        
  
    
  
  About

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="A.V.A.T.A.R" class="md-nav__button md-logo" aria-label="A.V.A.T.A.R" data-md-component="logo">
      
  <img src="../img/Avatar.png" alt="logo">

    </a>
    A.V.A.T.A.R
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Installation
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Installation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../introduction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../server-install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Server installation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Installing a client
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Installing a client
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../client-install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Client installation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../certificate/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HTTPS certificate
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Getting started
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Getting started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting-started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting started
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Settings
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Settings
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../server-properties/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Server settings
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../client-properties/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Client settings
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Concepts
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            Concepts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../voice-rules/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Voice rules
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../plugin-rules/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Plugin rules
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../virtual-client/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Virtual client
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tools
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            Tools
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../plugin-studio/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Plugin Studio
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Developer Guide
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Developer Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developer-guide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tutorial
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Tutorial
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorial-prerequisites/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Prerequisites
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorial-create-plugin/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Create a plugin
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorial-plugin-folders-files/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Folders and files
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorial-nlp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Natural Language Processing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorial-intention/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    The intent
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorial-action/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    L'action
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorial-script/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Le script
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorial-packager/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Packager
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    API
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../server-API/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Server
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../client-API/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Client
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Examples
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developer-examples/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../time/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Créer un plugin
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../meteo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Créer un widget bouton (Part 1)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Créer une fenêtre (Part 2)
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Créer une fenêtre (Part 2)
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#comprendre-les-fichiers" class="md-nav__link">
    <span class="md-ellipsis">
      Comprendre les fichiers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Comprendre les fichiers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#main-process" class="md-nav__link">
    <span class="md-ellipsis">
      Main process
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pre-load" class="md-nav__link">
    <span class="md-ellipsis">
      Pre load
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#renderer-process" class="md-nav__link">
    <span class="md-ellipsis">
      Renderer process
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Renderer process">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#javascript" class="md-nav__link">
    <span class="md-ellipsis">
      javascript
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#html" class="md-nav__link">
    <span class="md-ellipsis">
      HTML
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#css" class="md-nav__link">
    <span class="md-ellipsis">
      CSS
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#en-resume" class="md-nav__link">
    <span class="md-ellipsis">
      En résumé
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creer-les-fichiers-du-plugin" class="md-nav__link">
    <span class="md-ellipsis">
      Créer les fichiers du plugin
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Créer les fichiers du plugin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#le-fichier-pre-load" class="md-nav__link">
    <span class="md-ellipsis">
      Le fichier Pre load
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#le-fichier-html" class="md-nav__link">
    <span class="md-ellipsis">
      Le fichier HTML
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#le-fichier-javacript" class="md-nav__link">
    <span class="md-ellipsis">
      Le fichier javacript
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#le-fichier-css" class="md-nav__link">
    <span class="md-ellipsis">
      Le fichier CSS
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creer-la-fenetre" class="md-nav__link">
    <span class="md-ellipsis">
      Créer la fenêtre
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Créer la fenêtre">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#explications" class="md-nav__link">
    <span class="md-ellipsis">
      Explications
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Explications">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#avatarinterfacemainwindow" class="md-nav__link">
    <span class="md-ellipsis">
      Avatar.Interface.mainWindow()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#class-browserwindow" class="md-nav__link">
    <span class="md-ellipsis">
      class BrowserWindow #
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#winshow-event-method" class="md-nav__link">
    <span class="md-ellipsis">
      win.show() event method #
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#event-methods" class="md-nav__link">
    <span class="md-ellipsis">
      Event methods
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#window-position" class="md-nav__link">
    <span class="md-ellipsis">
      window position
    </span>
  </a>
  
    <nav class="md-nav" aria-label="window position">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#save" class="md-nav__link">
    <span class="md-ellipsis">
      Save
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#restore" class="md-nav__link">
    <span class="md-ellipsis">
      restore
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#restore-window-state" class="md-nav__link">
    <span class="md-ellipsis">
      Restore window state
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ajoutez-la-meteo" class="md-nav__link">
    <span class="md-ellipsis">
      Ajoutez la météo
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transferer-des-informations-entre-les-main-et-renderer-processus" class="md-nav__link">
    <span class="md-ellipsis">
      Transférer des informations entre les Main et Renderer processus
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Transférer des informations entre les Main et Renderer processus">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#type-1-envoyer-un-message-au-moteur-de-rendu" class="md-nav__link">
    <span class="md-ellipsis">
      Type 1: Envoyer un message au moteur de rendu
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Type 1: Envoyer un message au moteur de rendu">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#contentssendchannel-args" class="md-nav__link">
    <span class="md-ellipsis">
      contents.send(channel, ...args)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ipcrendereronchannel-listener" class="md-nav__link">
    <span class="md-ellipsis">
      ipcRenderer.on(channel, listener)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#type-3-le-rendu-demande-une-information-au-processus-principal-et-attend-la-reponse-bidirectionnel" class="md-nav__link">
    <span class="md-ellipsis">
      Type 3: Le rendu demande une information au processus principal et attend la réponse (bidirectionnel)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Type 3: Le rendu demande une information au processus principal et attend la réponse (bidirectionnel)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ipcmainhandlechannel-listener" class="md-nav__link">
    <span class="md-ellipsis">
      ipcMain.handle(channel, listener)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ipcrendererinvokechannel-args" class="md-nav__link">
    <span class="md-ellipsis">
      ipcRenderer.invoke(channel, ...args)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#type-2-le-rendu-envoie-une-information-au-processus-principal-unidirectionnel" class="md-nav__link">
    <span class="md-ellipsis">
      Type 2: Le rendu envoie une information au processus principal (unidirectionnel)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Type 2: Le rendu envoie une information au processus principal (unidirectionnel)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ipcmainonchannel-listener" class="md-nav__link">
    <span class="md-ellipsis">
      ipcMain.on(channel, listener)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ipcrenderersendchannel-args" class="md-nav__link">
    <span class="md-ellipsis">
      ipcRenderer.send(channel, ...args)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#finalisation" class="md-nav__link">
    <span class="md-ellipsis">
      Finalisation
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../meteo-widget-client/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Transférer le plugin vers un client (Part 3)
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../about/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#comprendre-les-fichiers" class="md-nav__link">
    <span class="md-ellipsis">
      Comprendre les fichiers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Comprendre les fichiers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#main-process" class="md-nav__link">
    <span class="md-ellipsis">
      Main process
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pre-load" class="md-nav__link">
    <span class="md-ellipsis">
      Pre load
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#renderer-process" class="md-nav__link">
    <span class="md-ellipsis">
      Renderer process
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Renderer process">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#javascript" class="md-nav__link">
    <span class="md-ellipsis">
      javascript
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#html" class="md-nav__link">
    <span class="md-ellipsis">
      HTML
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#css" class="md-nav__link">
    <span class="md-ellipsis">
      CSS
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#en-resume" class="md-nav__link">
    <span class="md-ellipsis">
      En résumé
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creer-les-fichiers-du-plugin" class="md-nav__link">
    <span class="md-ellipsis">
      Créer les fichiers du plugin
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Créer les fichiers du plugin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#le-fichier-pre-load" class="md-nav__link">
    <span class="md-ellipsis">
      Le fichier Pre load
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#le-fichier-html" class="md-nav__link">
    <span class="md-ellipsis">
      Le fichier HTML
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#le-fichier-javacript" class="md-nav__link">
    <span class="md-ellipsis">
      Le fichier javacript
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#le-fichier-css" class="md-nav__link">
    <span class="md-ellipsis">
      Le fichier CSS
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creer-la-fenetre" class="md-nav__link">
    <span class="md-ellipsis">
      Créer la fenêtre
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Créer la fenêtre">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#explications" class="md-nav__link">
    <span class="md-ellipsis">
      Explications
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Explications">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#avatarinterfacemainwindow" class="md-nav__link">
    <span class="md-ellipsis">
      Avatar.Interface.mainWindow()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#class-browserwindow" class="md-nav__link">
    <span class="md-ellipsis">
      class BrowserWindow #
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#winshow-event-method" class="md-nav__link">
    <span class="md-ellipsis">
      win.show() event method #
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#event-methods" class="md-nav__link">
    <span class="md-ellipsis">
      Event methods
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#window-position" class="md-nav__link">
    <span class="md-ellipsis">
      window position
    </span>
  </a>
  
    <nav class="md-nav" aria-label="window position">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#save" class="md-nav__link">
    <span class="md-ellipsis">
      Save
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#restore" class="md-nav__link">
    <span class="md-ellipsis">
      restore
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#restore-window-state" class="md-nav__link">
    <span class="md-ellipsis">
      Restore window state
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ajoutez-la-meteo" class="md-nav__link">
    <span class="md-ellipsis">
      Ajoutez la météo
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transferer-des-informations-entre-les-main-et-renderer-processus" class="md-nav__link">
    <span class="md-ellipsis">
      Transférer des informations entre les Main et Renderer processus
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Transférer des informations entre les Main et Renderer processus">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#type-1-envoyer-un-message-au-moteur-de-rendu" class="md-nav__link">
    <span class="md-ellipsis">
      Type 1: Envoyer un message au moteur de rendu
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Type 1: Envoyer un message au moteur de rendu">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#contentssendchannel-args" class="md-nav__link">
    <span class="md-ellipsis">
      contents.send(channel, ...args)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ipcrendereronchannel-listener" class="md-nav__link">
    <span class="md-ellipsis">
      ipcRenderer.on(channel, listener)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#type-3-le-rendu-demande-une-information-au-processus-principal-et-attend-la-reponse-bidirectionnel" class="md-nav__link">
    <span class="md-ellipsis">
      Type 3: Le rendu demande une information au processus principal et attend la réponse (bidirectionnel)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Type 3: Le rendu demande une information au processus principal et attend la réponse (bidirectionnel)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ipcmainhandlechannel-listener" class="md-nav__link">
    <span class="md-ellipsis">
      ipcMain.handle(channel, listener)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ipcrendererinvokechannel-args" class="md-nav__link">
    <span class="md-ellipsis">
      ipcRenderer.invoke(channel, ...args)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#type-2-le-rendu-envoie-une-information-au-processus-principal-unidirectionnel" class="md-nav__link">
    <span class="md-ellipsis">
      Type 2: Le rendu envoie une information au processus principal (unidirectionnel)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Type 2: Le rendu envoie une information au processus principal (unidirectionnel)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ipcmainonchannel-listener" class="md-nav__link">
    <span class="md-ellipsis">
      ipcMain.on(channel, listener)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ipcrenderersendchannel-args" class="md-nav__link">
    <span class="md-ellipsis">
      ipcRenderer.send(channel, ...args)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#finalisation" class="md-nav__link">
    <span class="md-ellipsis">
      Finalisation
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="weather-forecast-part-2">Weather forecast - Part 2</h1>
<p>Dans la 2ème partie, nous allons ajouter une fenêtre fille de l'interface A.V.A.T.A.R construite avec le framework <a href="https://www.electronjs.org/docs/latest/">Electron</a></p>
<p>Développer une fenêtre pour un plugin est facilité par A.V.A.T.A.R. Il n'est pas nécessaire de construire une application Electron complète, vous utilisez seulement les méthodes de l'API. </p>
<h2 id="comprendre-les-fichiers">Comprendre les fichiers</h2>
<p>Pour construire une fenêtre, plusieurs fichiers sont nécessaires:</p>
<h3 id="main-process">Main process</h3>
<p>Le fichier "main process" est le fichier script node.js du plugin (coté serveur web).<br />
Dans ce fichier sont effectuées toutes les actions qui sont en relation avec A.V.A.TA.R et le script du plugin, comme par exemple la création d'une fenêtre fille.</p>
<h3 id="pre-load">Pre load</h3>
<p>Le fichier "pre load" est une passerelle entre le "main process" et le "renderer process" (coté client Chromium).<br />
Dans ce fichier sont définies les "méthodes passerelles" qui enverront ou recevront des informations entre le "main process" et le "renderer process" via ce processus de communication.</p>
<h3 id="renderer-process">Renderer process</h3>
<details class="info" open="open">
<summary>Important</summary>
<p>Les processus de rendu d'Electron sont exécutés dans un bac à sable.<br />
Ils se comportent de la même manière qu'un processus de rendu Chrome normal. Un moteur de rendu en bac à sable n'aura donc pas d'environnement Node.js initialisé. Plus simplement, vous ne pouvez pas utiliser node.js dans un processus de rendu.</p>
<p>Le bac à sable limite les dommages que peut causer un code malveillant en limitant l'accès à la plupart des ressources du système  et ne peuvent utiliser librement que les cycles de l'unité centrale et la mémoire.</p>
</details>
<p>Le "renderer process" comprend 3 principaux fichiers:</p>
<h4 id="javascript">javascript</h4>
<p>Dans ce fichier sont reçus ou envoyées toutes les communications du "main process" (en passant par le "pre load") mais aussi, peut effectuer toutes les actions javascript de l'interface web (coté client Chromium).</p>
<details class="note" open="open">
<summary>Note</summary>
<p>Il n'est pas nécessaire d'avoir un fichier javascript si aucune communication entre le "main process" et le "renderer process" n'est effectuée, ni aucune fonction javascript pour la page web.</p>
</details>
<h4 id="html">HTML</h4>
<p>Le fichier "html" est le fichier de rendu de la page web. Le fichier javascript est appelé dans ce fichier.</p>
<h4 id="css">CSS</h4>
<p>Le fichier "css" est le fichier de mise en forme de la page web. il est appelé dans le fichier "html".</p>
<h3 id="en-resume">En résumé</h3>
<table>
<thead>
<tr>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">SubType</th>
<th style="text-align: center;">language</th>
<th style="text-align: center;">Obligatoire</th>
<th style="text-align: left;">Format</th>
<th style="text-align: left;">Commentaire</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Main process</td>
<td style="text-align: left;"></td>
<td style="text-align: center;">node.js<br>&gt;= ES6</td>
<td style="text-align: center;"><strong>oui</strong></td>
<td style="text-align: left;">&lt;plugin&gt;.js</td>
<td style="text-align: left;">Le script du plugin</td>
</tr>
<tr>
<td style="text-align: left;">Pre load</td>
<td style="text-align: left;"></td>
<td style="text-align: center;">node.js<br>CommonJS</td>
<td style="text-align: center;">non</td>
<td style="text-align: left;">&lt;plugin&gt;-preload.js</td>
<td style="text-align: left;">Le fichier passerelle.<br>Obligatoire seulement si une communication d'information est nécessaire entre le Main proccess et le Renderer process</td>
</tr>
<tr>
<td style="text-align: left;">Renderer</td>
<td style="text-align: left;">javascript</td>
<td style="text-align: center;">&gt;= ES6</td>
<td style="text-align: center;">non</td>
<td style="text-align: left;">&lt;plugin&gt;-renderer.js</td>
<td style="text-align: left;">Obligatoire seulement si une communication d'information est nécessaire avec le Main proccess</td>
</tr>
<tr>
<td style="text-align: left;">Renderer</td>
<td style="text-align: left;">html</td>
<td style="text-align: center;">html</td>
<td style="text-align: center;"><strong>oui</strong></td>
<td style="text-align: left;">&lt;plugin&gt;.html</td>
<td style="text-align: left;">Le fichier de rendu de la page web</td>
</tr>
<tr>
<td style="text-align: left;">Renderer</td>
<td style="text-align: left;">css</td>
<td style="text-align: center;">css</td>
<td style="text-align: center;">non</td>
<td style="text-align: left;">&lt;plugin&gt;.css</td>
<td style="text-align: left;">Le fichier de mise en forme de la page web</td>
</tr>
</tbody>
</table>
<h2 id="creer-les-fichiers-du-plugin">Créer les fichiers du plugin</h2>
<h3 id="le-fichier-pre-load">Le fichier Pre load</h3>
<ol>
<li>Ouvrez un terminal et déplacez-vous dans le répertoire du plugin
    <div class="highlight"><pre><span></span><code>cd &lt;A.V.A..T.A.R&gt;/resources/app/cores/plugin/weather
</code></pre></div></li>
<li>Créez un fichier <em>weather-preload.js</em></li>
<li>
<p>Copiez le template de fichier pre load ci-dessous dans le fichier</p>
<div class="highlight"><span class="filename">weather-preload.js</span><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">contextBridge</span><span class="p">,</span><span class="w"> </span><span class="nx">ipcRenderer</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;electron&#39;</span><span class="p">)</span>

<span class="nx">contextBridge</span><span class="p">.</span><span class="nx">exposeInMainWorld</span><span class="p">(</span><span class="s1">&#39;electronAPI&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>

<span class="p">})</span>
</code></pre></div>
</li>
</ol>
<h3 id="le-fichier-html">Le fichier HTML</h3>
<ol>
<li>Dans le répertoire du plugin, créez un fichier <em>weather.html</em></li>
<li>
<p>Copiez le template de fichier html ci-dessous dans le fichier</p>
<p><strong>Note:</strong> Les import du <em>weather.css</em> et du <em>weather-renderer.js</em> sont inclus</p>
<div class="highlight"><span class="filename">weather.html</span><pre><span></span><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&quot;Content-Security-Policy&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;default-src &#39;self&#39;; script-src &#39;self&#39;; script-src-elem &#39;self&#39;; style-src &#39;self&#39; &#39;unsafe-inline&#39;&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&quot;X-Content-Security-Policy&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;default-src &#39;self&#39;; script-src &#39;self&#39;&quot;</span><span class="p">/&gt;</span>
        <span class="p">&lt;</span><span class="nt">link</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;./weather.css&quot;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/css&quot;</span> <span class="p">/&gt;</span>
    <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>

        <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;./weather-renderer.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>
</li>
</ol>
<h3 id="le-fichier-javacript">Le fichier javacript</h3>
<ol>
<li>Dans le répertoire du plugin, créez un fichier <em>weather-renderer.js</em></li>
<li>Pour l'instant, le fichier est vide</li>
</ol>
<h3 id="le-fichier-css">Le fichier CSS</h3>
<ol>
<li>Dans le répertoire du plugin, créez un fichier <em>weather.css</em></li>
<li>
<p>Copiez le template de fichier css ci-dessous dans le fichier</p>
<div class="highlight"><span class="filename">weather.css</span><pre><span></span><code><span class="nt">body</span><span class="o">,</span><span class="w"> </span><span class="nt">html</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">width</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
<span class="w">    </span><span class="k">height</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
<span class="w">    </span><span class="k">overflow</span><span class="p">:</span><span class="w"> </span><span class="kc">hidden</span><span class="p">;</span>
<span class="w">    </span><span class="k">margin</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="kp">-webkit-</span><span class="n">app-region</span><span class="p">:</span><span class="w"> </span><span class="n">drag</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</li>
</ol>
<h2 id="creer-la-fenetre">Créer la fenêtre</h2>
<p>Dans le script du plugin,</p>
<ol>
<li>
<p>Ajoutez une variable globale <em>WeatherWindow</em></p>
<div class="highlight"><span class="filename">weather.js</span><pre><span></span><code><span class="hll"><span class="c1">// Private</span>
</span><span class="hll"><span class="kd">let</span><span class="w"> </span><span class="nx">WeatherWindow</span><span class="p">;</span><span class="w"> </span><span class="c1">// weather forecast window</span>
</span><span class="kd">let</span><span class="w"> </span><span class="nx">currentwidgetState</span><span class="p">;</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">periphInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span><span class="w"> </span><span class="c1">// devices table</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">Locale</span><span class="p">;</span><span class="w"> </span><span class="c1">//language pak</span>
</code></pre></div>
</li>
<li>
<p>Ajoutez les actions du bouton</p>
<div class="highlight"><span class="filename">weather.js</span><pre><span></span><code><span class="k">export</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">widgetAction</span><span class="w"> </span><span class="p">(</span><span class="nx">even</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Save current state</span>
<span class="w">    </span><span class="nx">currentwidgetState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">even</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">action</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;On&#39;</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// If &#39;On&#39;, show window</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">WeatherWindow</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">even</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">action</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;On&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">openWeatherWindow</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// If &#39;Off&#39;, destroy window</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">WeatherWindow</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">even</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">action</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;Off&#39;</span><span class="p">)</span><span class="w"> </span><span class="nx">WeatherWindow</span><span class="p">.</span><span class="nx">destroy</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>Ajoutez dans le script du plugin la méthode suivante à la fin du fichier:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">weather.js</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">openWeatherWindow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">WeatherWindow</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">WeatherWindow</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">style</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">parent</span><span class="o">:</span><span class="w"> </span><span class="nx">Avatar</span><span class="p">.</span><span class="nx">Interface</span><span class="p">.</span><span class="nx">mainWindow</span><span class="p">(),</span>
<span class="w">        </span><span class="nx">frame</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="nx">movable</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">        </span><span class="nx">resizable</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="nx">minimizable</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="nx">alwaysOnTop</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="nx">show</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="nx">width</span><span class="o">:</span><span class="w"> </span><span class="mf">150</span><span class="p">,</span>
<span class="w">        </span><span class="nx">height</span><span class="o">:</span><span class="w"> </span><span class="mf">320</span><span class="p">,</span>
<span class="w">        </span><span class="nx">opacity</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="w">        </span><span class="nx">icon</span><span class="o">:</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;assets&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;images&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;weather.png&#39;</span><span class="p">),</span>
<span class="w">        </span><span class="nx">webPreferences</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">preload</span><span class="o">:</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;weather-preload.js&#39;</span><span class="p">)</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Weather forecast&quot;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">WeatherWindow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">Avatar</span><span class="p">.</span><span class="nx">Interface</span><span class="p">.</span><span class="nx">BrowserWindow</span><span class="p">(</span><span class="nx">style</span><span class="p">,</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;weather.html&#39;</span><span class="p">),</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>

<span class="w">    </span><span class="nx">WeatherWindow</span><span class="p">.</span><span class="nx">once</span><span class="p">(</span><span class="s1">&#39;ready-to-show&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">WeatherWindow</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span>
<span class="w">    </span><span class="p">})</span>

<span class="w">    </span><span class="nx">WeatherWindow</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;closed&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">WeatherWindow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">    </span><span class="p">})</span><span class="w">  </span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>Redémarrez A.V.A.T.A.R</p>
</li>
<li>Testez le widget bouton <ul>
<li>Vous pouvez aussi essayer de déplacer la fenêtre en faisant un drag&amp;drop</li>
</ul>
</li>
</ol>
<h3 id="explications">Explications</h3>
<p>Quelques explications sur les méthodes et objects de la création de la fenêtre dans la méthode <em>openWeatherWindow</em> </p>
<h4 id="avatarinterfacemainwindow">Avatar.Interface.mainWindow()</h4>
<p>Returns the A.V.A.T.A.R main window</p>
<h4 id="class-browserwindow">class BrowserWindow <a href="https://www.electronjs.org/docs/latest/api/browser-window#class-browserwindow-extends-basewindow">#</a></h4>
<p>Create and control browser windows.  </p>
<details class="warning" open="open">
<summary>Important</summary>
<p>This class is controled by A.V.A.T.A.R. You have to use the <a href="API.md#avatarinterfacebrowserwindowoptions-html-ismenu"><em>Avatar.Interface.BrowserWindow()</em></a> to create a new browser window.</p>
</details>
<ul>
<li>line 23: Create a new browser window
<div class="highlight"><pre><span></span><code><span class="nx">WeatherWindow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">Avatar</span><span class="p">.</span><span class="nx">Interface</span><span class="p">.</span><span class="nx">BrowserWindow</span><span class="p">(</span><span class="nx">style</span><span class="p">,</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;weather.html&#39;</span><span class="p">),</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>
</code></pre></div></li>
</ul>
<h4 id="winshow-event-method">win.show() event method <a href="https://www.electronjs.org/docs/latest/api/browser-window#winshow">#</a></h4>
<p>Shows and gives focus to the window. </p>
<ul>
<li>
<p>line 3: Creates window only if the WeatherWindow variable is undefined.
<div class="highlight"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">WeatherWindow</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">WeatherWindow</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span>
</code></pre></div></p>
</li>
<li>
<p>line 26: Show the window when the event <code>ready-to-show</code> is emitted 
<div class="highlight"><pre><span></span><code><span class="nx">WeatherWindow</span><span class="p">.</span><span class="nx">once</span><span class="p">(</span><span class="s1">&#39;ready-to-show&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="hll"><span class="w">    </span><span class="nx">WeatherWindow</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span>
</span><span class="p">})</span>
</code></pre></div></p>
</li>
</ul>
<h4 id="event-methods">Event methods</h4>
<p><strong>Event: 'ready-to-show' <a href="https://www.electronjs.org/docs/latest/api/browser-window#event-ready-to-show">#</a></strong><br />
Emitted when the web page has been rendered (while not being shown) and window can be displayed without a visual flash.</p>
<div class="highlight"><pre><span></span><code><span class="hll"><span class="nx">WeatherWindow</span><span class="p">.</span><span class="nx">once</span><span class="p">(</span><span class="s1">&#39;ready-to-show&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span class="w">    </span><span class="nx">WeatherWindow</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span>
<span class="p">})</span>
</code></pre></div>
<p><strong>Event: 'closed' <a href="https://www.electronjs.org/docs/latest/api/browser-window#event-closed">#</a></strong><br />
Emitted when the window is closed. After you have received this event you should remove the reference to the window and avoid using it any more.</p>
<div class="highlight"><pre><span></span><code><span class="hll"><span class="nx">WeatherWindow</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;closed&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span class="w">    </span><span class="nx">WeatherWindow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="p">})</span><span class="w">  </span>
</code></pre></div>
<h2 id="window-position">window position</h2>
<h3 id="save">Save</h3>
<p>La sauvegarde de la position de la fenêtre est effectuée lorsque A.V.A.T.A.R est redémarré ou quitter.</p>
<ol>
<li>
<p>Ajoutez <code>fs-extra</code>dans les imports</p>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">path</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;node:path&#39;</span><span class="p">;</span>
<span class="hll"><span class="k">import</span><span class="w"> </span><span class="nx">fs</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;fs-extra&#39;</span><span class="p">;</span>
</span><span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">url</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;url&#39;</span><span class="p">;</span>
</code></pre></div>
</li>
<li>
<p>Ajoutez dans la méthode <em>onClose()</em> le test de sauvegarde comme ci-dessous</p>
<div class="highlight"><pre><span></span><code><span class="k">export</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">onClose</span><span class="w"> </span><span class="p">(</span><span class="nx">widgets</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Save widget position</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">Config</span><span class="p">.</span><span class="nx">modules</span><span class="p">.</span><span class="nx">weather</span><span class="p">.</span><span class="nx">widget</span><span class="p">.</span><span class="nx">display</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="nx">Widget</span><span class="p">.</span><span class="nx">initVar</span><span class="p">(</span><span class="nx">widgetFolder</span><span class="p">,</span><span class="w"> </span><span class="nx">widgetImgFolder</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="nx">Config</span><span class="p">.</span><span class="nx">modules</span><span class="p">.</span><span class="nx">weather</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">widgets</span><span class="p">)</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">Widget</span><span class="p">.</span><span class="nx">saveWidgets</span><span class="p">(</span><span class="nx">widgets</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="hll"><span class="w">    </span><span class="c1">// Save meteo forecast position</span>
</span><span class="hll"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">WeatherWindow</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// The window is displayed</span>
</span><span class="hll"><span class="w">        </span><span class="c1">// Get window instance position</span>
</span><span class="hll"><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">WeatherWindow</span><span class="p">.</span><span class="nx">getPosition</span><span class="p">();</span>
</span><span class="hll"><span class="w">        </span><span class="c1">// Writes position and the window state (displayed or closed)</span>
</span><span class="hll"><span class="w">        </span><span class="nx">fs</span><span class="p">.</span><span class="nx">writeJsonSync</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;assets&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;style.json&#39;</span><span class="p">),</span><span class="w"> </span><span class="p">{</span>
</span><span class="hll"><span class="w">        </span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="nx">pos</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span>
</span><span class="hll"><span class="w">        </span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="nx">pos</span><span class="p">[</span><span class="mf">1</span><span class="p">],</span>
</span><span class="hll"><span class="w">        </span><span class="nx">start</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span class="hll"><span class="w">        </span><span class="p">});</span>
</span><span class="hll"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="c1">// The window is closed</span>
</span><span class="hll"><span class="w">        </span><span class="c1">// If the backup file exists then keeps the position first</span>
</span><span class="hll"><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">prop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
</span><span class="hll"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">existsSync</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;assets&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;style.json&#39;</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
</span><span class="hll"><span class="w">            </span><span class="nx">prop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">readJsonSync</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;assets&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;style.json&#39;</span><span class="p">),</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kr">throws</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="p">});</span>
</span><span class="hll"><span class="w">        </span><span class="p">}</span>
</span><span class="hll"><span class="w">        </span><span class="c1">// Writes the window state (closed)</span>
</span><span class="hll"><span class="w">        </span><span class="nx">prop</span><span class="p">.</span><span class="nx">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
</span><span class="hll"><span class="w">        </span><span class="nx">fs</span><span class="p">.</span><span class="nx">writeJsonSync</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;assets&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;style.json&#39;</span><span class="p">),</span><span class="w"> </span><span class="nx">prop</span><span class="p">);</span>
</span><span class="hll"><span class="w">    </span><span class="p">}</span>
</span><span class="p">}</span><span class="w"> </span>
</code></pre></div>
</li>
</ol>
<h3 id="restore">restore</h3>
<p>La restitution de la position de la fenêtre est effectuée à la création de la fenêtre.</p>
<ol>
<li>
<p>Ajoutez dans la méthode <em>openWeatherWindow()</em> la restitution de la position comme ci-dessous</p>
<div class="highlight"><span class="filename">weather.js</span><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">openWeatherWindow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">WeatherWindow</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">WeatherWindow</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">style</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">parent</span><span class="o">:</span><span class="w"> </span><span class="nx">Avatar</span><span class="p">.</span><span class="nx">Interface</span><span class="p">.</span><span class="nx">mainWindow</span><span class="p">(),</span>
<span class="w">        </span><span class="nx">frame</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="nx">movable</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">        </span><span class="nx">resizable</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="nx">minimizable</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="nx">alwaysOnTop</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="nx">show</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="nx">width</span><span class="o">:</span><span class="w"> </span><span class="mf">150</span><span class="p">,</span>
<span class="w">        </span><span class="nx">height</span><span class="o">:</span><span class="w"> </span><span class="mf">320</span><span class="p">,</span>
<span class="w">        </span><span class="nx">opacity</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="w">        </span><span class="nx">icon</span><span class="o">:</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;assets&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;images&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;weather.png&#39;</span><span class="p">),</span>
<span class="w">        </span><span class="nx">webPreferences</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">preload</span><span class="o">:</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;weather-preload.js&#39;</span><span class="p">)</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Weather forecast&quot;</span>
<span class="w">    </span><span class="p">};</span>

<span class="hll"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">existsSync</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;assets&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;style.json&#39;</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
</span><span class="hll"><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">prop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">readJsonSync</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;assets&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;style.json&#39;</span><span class="p">),</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kr">throws</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="p">});</span>
</span><span class="hll"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">prop</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span class="hll"><span class="w">            </span><span class="nx">style</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">prop</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
</span><span class="hll"><span class="w">            </span><span class="nx">style</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">prop</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
</span><span class="hll"><span class="w">        </span><span class="p">}</span>
</span><span class="hll"><span class="w">    </span><span class="p">}</span>
</span>
<span class="w">    </span><span class="nx">WeatherWindow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">Avatar</span><span class="p">.</span><span class="nx">Interface</span><span class="p">.</span><span class="nx">BrowserWindow</span><span class="p">(</span><span class="nx">style</span><span class="p">,</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;weather.html&#39;</span><span class="p">),</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>

<span class="w">    </span><span class="nx">WeatherWindow</span><span class="p">.</span><span class="nx">once</span><span class="p">(</span><span class="s1">&#39;ready-to-show&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">WeatherWindow</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span>
<span class="w">    </span><span class="p">})</span>

<span class="w">    </span><span class="nx">WeatherWindow</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;closed&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">WeatherWindow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">    </span><span class="p">})</span><span class="w">  </span>
<span class="p">}</span>
</code></pre></div>
</li>
</ol>
<h2 id="restore-window-state">Restore window state</h2>
<p>La restitution de l'état de la fenêtre est effectuée lorsque A.V.A.T.A.R a terminé d'afficher les widgets</p>
<ol>
<li>
<p>Ajoutez dans la méthode <em>readyToShow()</em> la restitution de l'état comme ci-dessous</p>
<p><div class="highlight"><span class="filename">weather.js</span><pre><span></span><code><span class="k">export</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">readyToShow</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="hll"><span class="w">    </span><span class="c1">// If a backup file exists</span>
</span><span class="hll"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">existsSync</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;assets&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;style.json&#39;</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
</span><span class="hll"><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">prop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">readJsonSync</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;assets&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;style.json&#39;</span><span class="p">),</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kr">throws</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="p">});</span>
</span><span class="hll"><span class="w">        </span><span class="c1">// Set currentwidgetState global variable</span>
</span><span class="hll"><span class="w">        </span><span class="nx">currentwidgetState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">prop</span><span class="p">.</span><span class="nx">start</span><span class="p">;</span>
</span><span class="hll"><span class="w">        </span><span class="c1">// currentwidgetState = true : creates and shows new window</span>
</span><span class="hll"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">currentwidgetState</span><span class="p">)</span><span class="w"> </span><span class="nx">openWeatherWindow</span><span class="p">();</span>
</span><span class="hll"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w">  </span>
</span><span class="hll"><span class="w">        </span><span class="c1">// not displayed if the window is closed</span>
</span><span class="hll"><span class="w">        </span><span class="nx">currentwidgetState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
</span><span class="hll">
</span><span class="hll"><span class="w">    </span><span class="c1">// Refreshs information of the button widget regarding window state (&#39;On&#39; or &#39;Off&#39; image)</span>
</span><span class="hll"><span class="w">    </span><span class="nx">Avatar</span><span class="p">.</span><span class="nx">Interface</span><span class="p">.</span><span class="nx">refreshWidgetInfo</span><span class="p">({</span><span class="nx">plugin</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;weather&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;808221&quot;</span><span class="p">});</span><span class="w">  </span>
</span><span class="p">}</span>
</code></pre></div>
2. Ajoutez la variable currentwidgetState à <code>false</code> dans l'event <code>closed</code> comme ci-dessous</p>
<div class="highlight"><span class="filename">weather.js</span><pre><span></span><code><span class="nx">WeatherWindow</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;closed&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="hll"><span class="w">    </span><span class="c1">// not displayed if the window is closed</span>
</span><span class="hll"><span class="w">    </span><span class="nx">currentwidgetState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
</span>
<span class="w">    </span><span class="nx">WeatherWindow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="p">})</span><span class="w">  </span>
</code></pre></div>
</li>
<li>
<p>Redémarrez A.V.A.T.A.R</p>
</li>
<li>Testez la sauvegarde/restore de la position et de l'état de la fenêtre </li>
</ol>
<h2 id="ajoutez-la-meteo">Ajoutez la météo</h2>
<p>Vous pouvez récupérer un widget météo d'une ville sur plusieurs sites. Soyez prudent sur le choix du site, certains récupèrent beaucoup d'information de connexion (comme weatherwidget.org), d'autres sont carrément répertoriés comme très dangereux (comme widget-meteo.com). Le plus simple est d'utiliser un site sécurisé (comme le site de <a href="https://meteofrance.com/widgets">météo France</a> qui donne aussi la météo dans tous les pays)</p>
<details class="warning" open="open">
<summary>Warning</summary>
<p>Souvenez-vous aussi de la création du fichier html. Ce fichier dû à l'exécution du rendu dans le bac à sable limite les dommages que peut causer un code malveillant mais impose aussi une validation des liens externes. Pour certains sites qui exécutent du code javascript, il vous faudra autoriser le site dans les <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/script-src">security policy</a></p>
</details>
<ol>
<li>Ouvrez un navigateur et connectez-vous sur le site de <a href="https://meteofrance.com/widgets">météo France</a> ou le site de votre choix</li>
<li>Récupérez le code html</li>
<li>
<p>Copiez-le dans le fichier html comme ci-dessous</p>
<p><div class="highlight"><span class="filename">weather.html</span><pre><span></span><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&quot;Content-Security-Policy&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;script-src &#39;self&#39;; script-src-elem &#39;self&#39;; style-src &#39;self&#39; &#39;unsafe-inline&#39;&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&quot;X-Content-Security-Policy&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;default-src &#39;self&#39;; script-src &#39;self&#39;&quot;</span><span class="p">/&gt;</span>
        <span class="p">&lt;</span><span class="nt">link</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;./weather.css&quot;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/css&quot;</span> <span class="p">/&gt;</span>
    <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="hll">        <span class="p">&lt;</span><span class="nt">iframe</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;widget_autocomplete_preview&quot;</span>  <span class="na">width</span><span class="o">=</span><span class="s">&quot;150&quot;</span> <span class="na">height</span><span class="o">=</span><span class="s">&quot;300&quot;</span> <span class="na">frameborder</span><span class="o">=</span><span class="s">&quot;0&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://meteofrance.com/widget/prevision/441090##3D6AA2&quot;</span> <span class="na">title</span><span class="o">=</span><span class="s">&quot;Prévisions Nantes par Météo-France&quot;</span><span class="p">&gt;</span> <span class="p">&lt;/</span><span class="nt">iframe</span><span class="p">&gt;</span>
</span>        <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;./weather-renderer.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>
4. Changez la taille de l'élément <em>iframe</em> pour width="100%" et height="100%"</p>
<p><div class="highlight"><span class="filename">weather.html</span><pre><span></span><code><span class="hll"><span class="p">&lt;</span><span class="nt">iframe</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;widget_autocomplete_preview&quot;</span>  <span class="na">width</span><span class="o">=</span><span class="s">&quot;100%&quot;</span> <span class="na">height</span><span class="o">=</span><span class="s">&quot;100%&quot;</span> <span class="na">frameborder</span><span class="o">=</span><span class="s">&quot;0&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://meteofrance.com/widget/prevision/441090##3D6AA2&quot;</span> <span class="na">title</span><span class="o">=</span><span class="s">&quot;Prévisions Nantes par Météo-France&quot;</span><span class="p">&gt;</span> <span class="p">&lt;/</span><span class="nt">iframe</span><span class="p">&gt;</span>
</span></code></pre></div>
5. Autorisez le site dans les security policy en l'ajoutant dans la police <code>default-src</code> comme ci-dessous
<div class="highlight"><span class="filename">weather.html</span><pre><span></span><code><span class="hll"><span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&quot;Content-Security-Policy&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;default-src &#39;self&#39; https://meteofrance.com; script-src &#39;self&#39;; script-src-elem &#39;self&#39;; style-src &#39;self&#39; &#39;unsafe-inline&#39;&quot;</span><span class="p">&gt;</span>
</span></code></pre></div>
6. Redémarrez A.V.A.T.A.R</p>
<p><img alt="meteo-displayed" src="../img/meteo-displayed.png" width="250" /></p>
</li>
</ol>
<details class="tip" open="open">
<summary>Tip</summary>
<p>Si vous constatez un problème de taille de fenêtre, vous pouvez l'ajuster dans le script et l'objet <em>style.width</em> et <em>style.height</em></p>
</details>
<h2 id="transferer-des-informations-entre-les-main-et-renderer-processus">Transférer des informations entre les Main et Renderer processus</h2>
<p>Nous pourrions nous arrêter là puisque le plugin est fonctionnel mais pour l'exemple, nous allons transférer des informations entre le main process et le renderer process.</p>
<p>Il existe plusieurs types de communication inter process (IPC):</p>
<p><strong>Type 1:</strong> Processus principal (Main) vers moteur de rendu (Renderer)<br />
<strong>Type 2:</strong> Moteur de rendu vers le processus principal (unidirectionnel)<br />
<strong>Type 3:</strong> Moteur de rendu vers le processus principal (bidirectionnel)</p>
<details class="tip" open="open">
<summary>Tip</summary>
<p>Pour vous familiariser avec ces concepts, vous pouvez lire la documentation Electron sur <a href="https://www.electronjs.org/fr/docs/latest/tutorial/ipc">La communication inter-processus</a></p>
</details>
<p>Dans notre exemple, nous allons d'abord utiliser le types 1 pour envoyer un message depuis le main process au moteur de rendu pour qu'il exécute une fonction puis ensuite le type 3 pour que le moteur de rendu demande une information au processus principal et recevoir la réponse, enfin nous utiliserons le type 2 pour que le moteur de rendu envoie un ordre d'exécution de fermeture de la fenêtre au processus principal.</p>
<h3 id="type-1-envoyer-un-message-au-moteur-de-rendu">Type 1: Envoyer un message au moteur de rendu</h3>
<p>L'envoi d'un message au moteur de rendu s'effectue via son instance <a href="https://www.electronjs.org/fr/docs/latest/api/web-contents">WebContents</a>, cette instance de WebContents contient une méthode <a href="https://www.electronjs.org/fr/docs/latest/api/web-contents#contentssendchannel-args">send</a> qui peut être utilisée.</p>
<ol>
<li>
<p>Ajoutez dans le script du plugin la méthode <code>send</code></p>
<h4 id="contentssendchannel-args">contents.send(channel, ...args)</h4>
<ul>
<li>channel string</li>
<li>...args any[]</li>
</ul>
<p>Envoye un message asynchrone et un certain nombre d'arguments au processus de rendu via channel</p>
<details class="warning">
<summary>Warning</summary>
<p>NOTE: L'envoi de types Javascript non standards tels que des objets DOM ou des objets spéciaux déclenchera une exception.</p>
</details>
<p>Pour notre exemple, nous devons signifier au moteur de rendu qu'il doit exécuter une action de mise à jour d'un elément <code>label</code> <strong>après</strong> son initialisation complète (afin que tous les eléments du DOM soient accessibles). Le moyen de faire ca est de placer la méthode <code>send</code> dans l'event <code>ready-to-show</code></p>
<div class="highlight"><span class="filename">weather.js</span><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">openWeatherWindow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">WeatherWindow</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">WeatherWindow</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">style</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">parent</span><span class="o">:</span><span class="w"> </span><span class="nx">Avatar</span><span class="p">.</span><span class="nx">Interface</span><span class="p">.</span><span class="nx">mainWindow</span><span class="p">(),</span>
<span class="w">        </span><span class="nx">frame</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="nx">movable</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">        </span><span class="nx">resizable</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="nx">minimizable</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="nx">alwaysOnTop</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="nx">show</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="nx">width</span><span class="o">:</span><span class="w"> </span><span class="mf">150</span><span class="p">,</span>
<span class="w">        </span><span class="nx">height</span><span class="o">:</span><span class="w"> </span><span class="mf">320</span><span class="p">,</span>
<span class="w">        </span><span class="nx">opacity</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="w">        </span><span class="nx">icon</span><span class="o">:</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;assets&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;images&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;weather.png&#39;</span><span class="p">),</span>
<span class="w">        </span><span class="nx">webPreferences</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">preload</span><span class="o">:</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;weather-preload.js&#39;</span><span class="p">)</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Weather forecast&quot;</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">existsSync</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;assets&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;style.json&#39;</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">prop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">readJsonSync</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;assets&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;style.json&#39;</span><span class="p">),</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kr">throws</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="p">});</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">prop</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">style</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">prop</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="nx">style</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">prop</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">WeatherWindow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">Avatar</span><span class="p">.</span><span class="nx">Interface</span><span class="p">.</span><span class="nx">BrowserWindow</span><span class="p">(</span><span class="nx">style</span><span class="p">,</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;weather.html&#39;</span><span class="p">),</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>

<span class="w">    </span><span class="nx">WeatherWindow</span><span class="p">.</span><span class="nx">once</span><span class="p">(</span><span class="s1">&#39;ready-to-show&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">WeatherWindow</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span>
<span class="hll"><span class="w">         </span><span class="nx">WeatherWindow</span><span class="p">.</span><span class="nx">webContents</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">&#39;onInit-weather&#39;</span><span class="p">);</span>
</span><span class="w">    </span><span class="p">})</span>

<span class="w">    </span><span class="nx">WeatherWindow</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;closed&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// not displayed if the window is closed</span>
<span class="w">        </span><span class="nx">currentwidgetState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>

<span class="w">        </span><span class="nx">WeatherWindow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">    </span><span class="p">})</span><span class="w">  </span>
<span class="p">}</span><span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Exposition de <code>ipcRenderer.on</code> via l'ajout dans le script de pre load</p>
<h4 id="ipcrendereronchannel-listener">ipcRenderer.on(channel, listener)</h4>
<ul>
<li>channel string</li>
<li>listener Function<ul>
<li>event IpcRendererEvent</li>
<li>...args any[]</li>
</ul>
</li>
</ul>
<p>Ecoute sur channel et listener sera appelé ainsi: listener(event, args...) à la réception d'un nouveau message.</p>
<div class="highlight"><span class="filename">weather-preload.js</span><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">contextBridge</span><span class="p">,</span><span class="w"> </span><span class="nx">ipcRenderer</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;electron&#39;</span><span class="p">)</span>

<span class="nx">contextBridge</span><span class="p">.</span><span class="nx">exposeInMainWorld</span><span class="p">(</span><span class="s1">&#39;electronAPI&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="hll"><span class="w">    </span><span class="nx">onInitWeather</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">ipcRenderer</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;onInit-weather&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">_event</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">callback</span><span class="p">(</span><span class="nx">value</span><span class="p">))</span>
</span><span class="p">})</span><span class="w">    </span>
</code></pre></div>
<p>Après avoir chargé le script de préchargement, votre processus de rendu aura accès à la fonction d’écoute <code>window.electronAPI.onInitWeather()</code>.</p>
</li>
<li>
<p>Ajoutez la fonction d’écoute dans le moteur de rendu</p>
<div class="highlight"><span class="filename">weather-renderer.js</span><pre><span></span><code><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">setElementLabel</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>

<span class="p">}</span>

<span class="nb">window</span><span class="p">.</span><span class="nx">electronAPI</span><span class="p">.</span><span class="nx">onInitWeather</span><span class="p">(</span><span class="w"> </span><span class="nx">_event</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">setElementLabel</span><span class="p">();</span>
<span class="p">})</span>
</code></pre></div>
</li>
</ol>
<p><strong>En résumé :</strong><br />
 Nous avons envoyé un message au rendu par la méthode <code>send</code> via le script de pre load par <code>ipcRenderer.on</code> et le rendu le reçoit via la fonction d'écoute <code>onInitWeather</code></p>
<p>Il nous reste maintenant à demander la valeur d'un elément <code>label</code>, pour ce faire nous établir une communication via le type 3 Moteur de rendu vers le processus principal (bidirectionnel)</p>
<h3 id="type-3-le-rendu-demande-une-information-au-processus-principal-et-attend-la-reponse-bidirectionnel">Type 3: Le rendu demande une information au processus principal et attend la réponse (bidirectionnel)</h3>
<p>Une communication bidirectionnel est l'appel d'un module du processus principal à partir du code du processus de rendu avec l'attente d'un résultat. Cela peut être fait en utilisant <a href="https://www.electronjs.org/fr/docs/latest/api/ipc-renderer#ipcrendererinvokechannel-args">ipcRenderer.invoke</a> dans le script de pre load jumelé avec <a href="https://www.electronjs.org/fr/docs/latest/api/ipc-main#ipcmainhandlechannel-listener">ipcMain.handle</a> dans le main process.</p>
<ol>
<li>
<p>Ajoutez un module d'écoute</p>
<h4 id="ipcmainhandlechannel-listener">ipcMain.handle(channel, listener)</h4>
<ul>
<li>channel string</li>
<li>listener Function<Promise\<any> | any><ul>
<li>event IpcMainInvokeEvent</li>
<li>...args any[]</li>
</ul>
</li>
</ul>
<p>Ajoute un module d'écoute sur <em>channel</em> dans le main process. Ce gestionnaire est appelé chaque fois que le processus de rendu appelle <code>ipcRenderer.invoke(channel, ...args)</code>.</p>
<p>Si listener renvoie une Promise, le résultat final de la promesse sera retourné en réponse à l'appelant distant. Sinon, la valeur de retour de l'écouteur sera utilisée comme valeur de la réponse.</p>
<details class="warning" open="open">
<summary>Warning</summary>
<ul>
<li>The IPC main is controled by A.V.A.T.A.R. You have to use the <a href="API.md#avatarinterfaceipcmain"><em>Avatar.Interface.ipcMain()</em></a> for returning the A.V.A.T.A.R ipcMain.</li>
<li>Un handle pour le <em>channel</em> ne peut être déclaré qu'une seule fois. Il doit <strong>obligatoirement</strong> être supprimé par un <a href="https://www.electronjs.org/fr/docs/latest/api/ipc-main#ipcmainremovehandlerchannel">ipcMain.removeHandler</a> avant d'être déclaré de nouveau.</li>
</ul>
</details>
<ul>
<li>Ajoutez dans la méthode <em>openWeatherWindow</em> l'ajout et la suppression du gestionnaire comme ci-dessous</li>
</ul>
<div class="highlight"><span class="filename">weather.js</span><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">openWeatherWindow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">WeatherWindow</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">WeatherWindow</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">style</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">parent</span><span class="o">:</span><span class="w"> </span><span class="nx">Avatar</span><span class="p">.</span><span class="nx">Interface</span><span class="p">.</span><span class="nx">mainWindow</span><span class="p">(),</span>
<span class="w">        </span><span class="nx">frame</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="nx">movable</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">        </span><span class="nx">resizable</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="nx">minimizable</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="nx">alwaysOnTop</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="nx">show</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="nx">width</span><span class="o">:</span><span class="w"> </span><span class="mf">150</span><span class="p">,</span>
<span class="w">        </span><span class="nx">height</span><span class="o">:</span><span class="w"> </span><span class="mf">320</span><span class="p">,</span>
<span class="w">        </span><span class="nx">opacity</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="w">        </span><span class="nx">icon</span><span class="o">:</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;assets&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;images&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;weather.png&#39;</span><span class="p">),</span>
<span class="w">        </span><span class="nx">webPreferences</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">preload</span><span class="o">:</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;weather-preload.js&#39;</span><span class="p">)</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Weather forecast&quot;</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">existsSync</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;assets&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;style.json&#39;</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">prop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">readJsonSync</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;assets&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;style.json&#39;</span><span class="p">),</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kr">throws</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="p">});</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">prop</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">style</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">prop</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="nx">style</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">prop</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">WeatherWindow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">Avatar</span><span class="p">.</span><span class="nx">Interface</span><span class="p">.</span><span class="nx">BrowserWindow</span><span class="p">(</span><span class="nx">style</span><span class="p">,</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;weather.html&#39;</span><span class="p">),</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>

<span class="w">    </span><span class="nx">WeatherWindow</span><span class="p">.</span><span class="nx">once</span><span class="p">(</span><span class="s1">&#39;ready-to-show&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">WeatherWindow</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span>
<span class="w">        </span><span class="nx">WeatherWindow</span><span class="p">.</span><span class="nx">webContents</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">&#39;onInit-weather&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="p">})</span>

<span class="hll"><span class="w">    </span><span class="c1">// returns the localized message defined in arg</span>
</span><span class="hll"><span class="w">    </span><span class="nx">Avatar</span><span class="p">.</span><span class="nx">Interface</span><span class="p">.</span><span class="nx">ipcMain</span><span class="p">().</span><span class="nx">handle</span><span class="p">(</span><span class="s1">&#39;weather-msg&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">_event</span><span class="p">,</span><span class="w"> </span><span class="nx">arg</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="k">return</span><span class="w"> </span><span class="nx">Locale</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">arg</span><span class="p">)});</span>
</span>
<span class="w">    </span><span class="nx">WeatherWindow</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;closed&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// not displayed if the window is closed</span>
<span class="w">        </span><span class="nx">currentwidgetState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>

<span class="hll"><span class="w">        </span><span class="c1">// Removes the handler `weather-msg` when the window is closed</span>
</span><span class="hll"><span class="w">        </span><span class="nx">Avatar</span><span class="p">.</span><span class="nx">Interface</span><span class="p">.</span><span class="nx">ipcMain</span><span class="p">().</span><span class="nx">removeHandler</span><span class="p">(</span><span class="s1">&#39;weather-msg&#39;</span><span class="p">);</span>
</span>
<span class="w">        </span><span class="nx">WeatherWindow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">    </span><span class="p">})</span><span class="w">  </span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>Exposition de <code>ipcRenderer.invoke</code> via l'ajout dans le script de pre load</p>
<h4 id="ipcrendererinvokechannel-args">ipcRenderer.invoke(channel, ...args)</h4>
<ul>
<li>channel string</li>
<li>...args any[]</li>
</ul>
<p>Retourne une Promise<any> - qui se résout avec la réponse du processus principal.</p>
<p>Envoie un message au processus principal via channel et attend un résultat asynchrone.</p>
<div class="highlight"><span class="filename">weather-preload.js</span><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">contextBridge</span><span class="p">,</span><span class="w"> </span><span class="nx">ipcRenderer</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;electron&#39;</span><span class="p">)</span>

<span class="nx">contextBridge</span><span class="p">.</span><span class="nx">exposeInMainWorld</span><span class="p">(</span><span class="s1">&#39;electronAPI&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">onInitWeather</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">ipcRenderer</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;onInit-weather&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">_event</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">callback</span><span class="p">(</span><span class="nx">value</span><span class="p">)),</span>
<span class="hll"><span class="w">    </span><span class="nx">getMsg</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">value</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">ipcRenderer</span><span class="p">.</span><span class="nx">invoke</span><span class="p">(</span><span class="s1">&#39;weather-msg&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">)</span>
</span><span class="p">})</span><span class="w">    </span>
</code></pre></div>
<p>Le module d'écoute <code>weather-msg</code> est appelé chaque fois que la fonction <code>window.electronAPI.getMsg()</code> du processus de rendu appelle <code>ipcRenderer.invoke()</code> </p>
</li>
<li>
<p>Ajoutez la fonction <em>getMsg()</em> dans le processus de rendu</p>
<div class="highlight"><span class="filename">weather-renderer.js</span><pre><span></span><code><span class="hll"><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">Lget</span><span class="w"> </span><span class="p">(</span><span class="nx">target</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span class="hll"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span class="hll"><span class="w">        </span><span class="nx">target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nx">target</span><span class="p">];</span>
</span><span class="hll"><span class="w">        </span><span class="nx">args</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">arg</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span class="hll"><span class="w">            </span><span class="nx">target</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">arg</span><span class="p">);</span>
</span><span class="hll"><span class="w">        </span><span class="p">})</span>
</span><span class="hll"><span class="w">    </span><span class="p">}</span><span class="w"> </span>
</span><span class="hll">
</span><span class="hll"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">electronAPI</span><span class="p">.</span><span class="nx">getMsg</span><span class="p">(</span><span class="nx">target</span><span class="p">);</span>
</span><span class="hll"><span class="p">}</span>
</span>
<span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">setElementLabel</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="hll"><span class="w">    </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;quit&#39;</span><span class="p">).</span><span class="nx">innerHTML</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">Lget</span><span class="p">(</span><span class="s2">&quot;message.quit&quot;</span><span class="p">);</span>
</span><span class="p">}</span>

<span class="nb">window</span><span class="p">.</span><span class="nx">electronAPI</span><span class="p">.</span><span class="nx">onInitWeather</span><span class="p">(</span><span class="w"> </span><span class="nx">_event</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">setElementLabel</span><span class="p">();</span><span class="w"> </span>
<span class="p">})</span><span class="w">  </span>
</code></pre></div>
</li>
<li>
<p>Localisez le message</p>
<ul>
<li>Modifiez le fichier <em>weather/locales/en.pak</em> comme ci-dessous</li>
</ul>
<p><strong>NOTE:</strong> Consultez <a href="API.md#lang-pakgetkey"><em>&lt;lang&gt;.get()</em></a> pour plus d'information</p>
<div class="highlight"><span class="filename">en.pak</span><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;quit&quot;</span><span class="p">:</span><span class="s2">&quot;X&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>Ajoutez un elément <code>label</code> dans le fichier html</p>
<p><div class="highlight"><span class="filename">weather.html</span><pre><span></span><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&quot;Content-Security-Policy&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;script-src &#39;self&#39;; script-src-elem &#39;self&#39;; style-src &#39;self&#39; &#39;unsafe-inline&#39;&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&quot;X-Content-Security-Policy&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;default-src &#39;self&#39;; script-src &#39;self&#39;&quot;</span><span class="p">/&gt;</span>
        <span class="p">&lt;</span><span class="nt">link</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;./weather.css&quot;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/css&quot;</span> <span class="p">/&gt;</span>
    <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">iframe</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;widget_autocomplete_preview&quot;</span>  <span class="na">width</span><span class="o">=</span><span class="s">&quot;150&quot;</span> <span class="na">height</span><span class="o">=</span><span class="s">&quot;300&quot;</span> <span class="na">frameborder</span><span class="o">=</span><span class="s">&quot;0&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://meteofrance.com/widget/prevision/441090##3D6AA2&quot;</span> <span class="na">title</span><span class="o">=</span><span class="s">&quot;Prévisions Nantes par Météo-France&quot;</span><span class="p">&gt;</span> <span class="p">&lt;/</span><span class="nt">iframe</span><span class="p">&gt;</span>
<span class="hll">        <span class="p">&lt;</span><span class="nt">label</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;quit&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;quit&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
</span>        <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;./weather-renderer.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>
6. Ajoutez un style dans le fichier css</p>
<div class="highlight"><span class="filename">weather.css</span><pre><span></span><code><span class="nt">body</span><span class="o">,</span><span class="w"> </span><span class="nt">html</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">width</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
<span class="w">    </span><span class="k">height</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
<span class="w">    </span><span class="k">overflow</span><span class="p">:</span><span class="w"> </span><span class="kc">hidden</span><span class="p">;</span>
<span class="w">    </span><span class="k">margin</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="kp">-webkit-</span><span class="n">app-region</span><span class="p">:</span><span class="w"> </span><span class="n">drag</span><span class="p">;</span>
<span class="p">}</span>

<span class="hll"><span class="p">.</span><span class="nc">quit</span><span class="p">{</span>
</span><span class="hll"><span class="w">    </span><span class="k">position</span><span class="p">:</span><span class="w"> </span><span class="kc">fixed</span><span class="p">;</span>
</span><span class="hll"><span class="w">    </span><span class="k">top</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="kt">px</span><span class="p">;</span>
</span><span class="hll"><span class="w">    </span><span class="k">right</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="kt">px</span><span class="p">;</span>
</span><span class="hll"><span class="w">    </span><span class="kp">-webkit-</span><span class="n">app-region</span><span class="p">:</span><span class="n">no-drag</span><span class="p">;</span>
</span><span class="hll"><span class="w">    </span><span class="k">font</span><span class="p">:</span><span class="w"> </span><span class="mi">13</span><span class="kt">px</span><span class="w"> </span><span class="n">helvetica</span><span class="w"> </span><span class="n">neue</span><span class="p">,</span><span class="w"> </span><span class="n">helvetica</span><span class="p">,</span><span class="w"> </span><span class="n">arial</span><span class="p">,</span><span class="w"> </span><span class="kc">sans-serif</span><span class="p">;</span>
</span><span class="hll"><span class="w">    </span><span class="k">font-weight</span><span class="p">:</span><span class="w"> </span><span class="kc">bold</span><span class="p">;</span>
</span><span class="hll"><span class="w">    </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="nb">rgb</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="w"> </span><span class="mi">255</span><span class="p">,</span><span class="w"> </span><span class="mi">255</span><span class="p">);</span>
</span><span class="hll"><span class="w">    </span><span class="k">z-index</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
</span><span class="hll"><span class="p">}</span>
</span><span class="hll"><span class="p">.</span><span class="nc">quit</span><span class="p">:</span><span class="nd">hover</span><span class="w"> </span><span class="p">{</span>
</span><span class="hll"><span class="w">    </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="nb">rgb</span><span class="p">(</span><span class="mi">247</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span>
</span><span class="hll"><span class="w">    </span><span class="k">cursor</span><span class="p">:</span><span class="w"> </span><span class="kc">pointer</span><span class="p">;</span>
</span><span class="hll"><span class="p">}</span>
</span></code></pre></div>
</li>
<li>
<p>Redémarrez A.V.A.T.A.R et vérifiez l'ajout de l'elément label <strong>X</strong> dans le coin haut droit</p>
<p><img alt="meteo-displayed-X" src="../img/meteo-displayed-X.png" width="150" /></p>
</li>
</ol>
<h3 id="type-2-le-rendu-envoie-une-information-au-processus-principal-unidirectionnel">Type 2: Le rendu envoie une information au processus principal (unidirectionnel)</h3>
<p>Une communication unidirectionnel est l'appel d'un module du processus principal à partir du code du processus de rendu. Cela peut être fait en utilisant <a href="https://www.electronjs.org/fr/docs/latest/api/ipc-renderer#ipcrendererinvokechannel-args">ipcRenderer.send</a> dans le script de pre load jumelé avec <a href="https://www.electronjs.org/fr/docs/latest/api/ipc-main#ipcmainonchannel-listener">ipcMain.on</a> dans le main process.</p>
<ol>
<li>
<p>Ajoutez un module d'écoute</p>
<h4 id="ipcmainonchannel-listener">ipcMain.on(channel, listener)</h4>
<ul>
<li>channel string</li>
<li>listener Function<ul>
<li>event IpcMainEvent</li>
<li>...args any[]</li>
</ul>
</li>
</ul>
<p>Ecoute sur channel et listener sera appelé ainsi: listener(event, args...) à la réception d'un nouveau message.</p>
<details class="warning" open="open">
<summary>Warning</summary>
<ul>
<li>The IPC main is controled by A.V.A.T.A.R. You have to use the <a href=""><em>Avatar.Interface.ipcMain()</em></a> for returning the A.V.A.T.A.R ipcMain.</li>
<li>Un Listener pour le <em>channel</em> ne peut être déclaré qu'une seule fois. Il doit <strong>obligatoirement</strong> être supprimé par un <a href="https://www.electronjs.org/fr/docs/latest/api/ipc-main#ipcmainremovealllistenerschannel">ipcMain.removeAllListeners</a> avant d'être déclaré de nouveau.</li>
</ul>
</details>
<p>Pour notre exemple, nous devons signifier au processus principal qu'il doit exécuter la fermeture de la fenêtre par un click de l'elément label <strong>X</strong>.  </p>
<p><strong>NOTE:</strong> Cette fermeture est réalisée par la méthode d'instance <a href="https://www.electronjs.org/fr/docs/latest/api/base-window#windestroy"><em>win.destroy()</em></a></p>
<ul>
<li>Ajoutez dans la méthode <em>openWeatherWindow</em> l'ajout et la suppression du module d'écoute comme ci-dessous</li>
</ul>
<div class="highlight"><span class="filename">weather.js</span><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">openWeatherWindow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">WeatherWindow</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">WeatherWindow</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">style</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">parent</span><span class="o">:</span><span class="w"> </span><span class="nx">Avatar</span><span class="p">.</span><span class="nx">Interface</span><span class="p">.</span><span class="nx">mainWindow</span><span class="p">(),</span>
<span class="w">        </span><span class="nx">frame</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="nx">movable</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">        </span><span class="nx">resizable</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="nx">minimizable</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="nx">alwaysOnTop</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="nx">show</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="nx">width</span><span class="o">:</span><span class="w"> </span><span class="mf">150</span><span class="p">,</span>
<span class="w">        </span><span class="nx">height</span><span class="o">:</span><span class="w"> </span><span class="mf">320</span><span class="p">,</span>
<span class="w">        </span><span class="nx">opacity</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="w">        </span><span class="nx">icon</span><span class="o">:</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;assets&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;images&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;weather.png&#39;</span><span class="p">),</span>
<span class="w">        </span><span class="nx">webPreferences</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">preload</span><span class="o">:</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;weather-preload.js&#39;</span><span class="p">)</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Weather forecast&quot;</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">existsSync</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;assets&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;style.json&#39;</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">prop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">readJsonSync</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;assets&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;style.json&#39;</span><span class="p">),</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kr">throws</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="p">});</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">prop</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">style</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">prop</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">            </span><span class="nx">style</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">prop</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">WeatherWindow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">Avatar</span><span class="p">.</span><span class="nx">Interface</span><span class="p">.</span><span class="nx">BrowserWindow</span><span class="p">(</span><span class="nx">style</span><span class="p">,</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;weather.html&#39;</span><span class="p">),</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>

<span class="w">    </span><span class="nx">WeatherWindow</span><span class="p">.</span><span class="nx">once</span><span class="p">(</span><span class="s1">&#39;ready-to-show&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">WeatherWindow</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span>
<span class="w">        </span><span class="nx">WeatherWindow</span><span class="p">.</span><span class="nx">webContents</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">&#39;onInit-weather&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="p">})</span>

<span class="hll"><span class="w">    </span><span class="c1">// Destroys window by a click on the &#39;X&#39; label </span>
</span><span class="hll"><span class="w">    </span><span class="nx">Avatar</span><span class="p">.</span><span class="nx">Interface</span><span class="p">.</span><span class="nx">ipcMain</span><span class="p">().</span><span class="nx">one</span><span class="p">(</span><span class="s1">&#39;weather-quit&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span class="hll"><span class="w">        </span><span class="c1">// Closed window</span>
</span><span class="hll"><span class="w">        </span><span class="nx">WeatherWindow</span><span class="p">.</span><span class="nx">destroy</span><span class="p">();</span>
</span><span class="hll">
</span><span class="hll"><span class="w">        </span><span class="c1">// refresh widget button on window closed</span>
</span><span class="hll"><span class="w">        </span><span class="nx">Avatar</span><span class="p">.</span><span class="nx">Interface</span><span class="p">.</span><span class="nx">refreshWidgetInfo</span><span class="p">({</span><span class="nx">plugin</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;weather&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;808221&quot;</span><span class="p">});</span>
</span><span class="hll"><span class="w">    </span><span class="p">});</span>
</span>
<span class="w">    </span><span class="c1">// returns the localized message defined in arg</span>
<span class="w">    </span><span class="nx">Avatar</span><span class="p">.</span><span class="nx">Interface</span><span class="p">.</span><span class="nx">ipcMain</span><span class="p">().</span><span class="nx">handle</span><span class="p">(</span><span class="s1">&#39;weather-msg&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">_event</span><span class="p">,</span><span class="w"> </span><span class="nx">arg</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="k">return</span><span class="w"> </span><span class="nx">Locale</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">arg</span><span class="p">)});</span>

<span class="w">    </span><span class="nx">WeatherWindow</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;closed&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// not displayed if the window is closed</span>
<span class="w">        </span><span class="nx">currentwidgetState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>

<span class="w">        </span><span class="c1">// Removes the `weather-msg` handler when the window is closed</span>
<span class="w">        </span><span class="nx">Avatar</span><span class="p">.</span><span class="nx">Interface</span><span class="p">.</span><span class="nx">ipcMain</span><span class="p">().</span><span class="nx">removeHandler</span><span class="p">(</span><span class="s1">&#39;weather-msg&#39;</span><span class="p">);</span>

<span class="hll"><span class="w">        </span><span class="c1">// Removes the `weather-quit` listener when the window is closed</span>
</span><span class="hll"><span class="w">        </span><span class="nx">Avatar</span><span class="p">.</span><span class="nx">Interface</span><span class="p">.</span><span class="nx">ipcMain</span><span class="p">().</span><span class="nx">removeAllListeners</span><span class="p">(</span><span class="s1">&#39;weather-quit&#39;</span><span class="p">);</span>
</span>
<span class="w">        </span><span class="nx">WeatherWindow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">    </span><span class="p">})</span><span class="w">  </span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>Exposition de <code>ipcRenderer.send</code> via l'ajout dans le script de pre load</p>
<h4 id="ipcrenderersendchannel-args">ipcRenderer.send(channel, ...args)</h4>
<ul>
<li>channel string</li>
<li>...args any[]</li>
</ul>
<p>Envoie un message asynchrone ainsi que des arguments au processus principal via channel.</p>
<div class="highlight"><span class="filename">weather-preload.js</span><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">contextBridge</span><span class="p">,</span><span class="w"> </span><span class="nx">ipcRenderer</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;electron&#39;</span><span class="p">)</span>

<span class="nx">contextBridge</span><span class="p">.</span><span class="nx">exposeInMainWorld</span><span class="p">(</span><span class="s1">&#39;electronAPI&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">onInitWeather</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">ipcRenderer</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;onInit-weather&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">_event</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">callback</span><span class="p">(</span><span class="nx">value</span><span class="p">)),</span>
<span class="w">    </span><span class="nx">getMsg</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">value</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">ipcRenderer</span><span class="p">.</span><span class="nx">invoke</span><span class="p">(</span><span class="s1">&#39;weather-msg&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">),</span>
<span class="hll"><span class="w">    </span><span class="nx">quit</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">ipcRenderer</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">&#39;weather-quit&#39;</span><span class="p">)</span>
</span><span class="p">})</span><span class="w">    </span>
</code></pre></div>
<p>Le listener <code>weather-quit</code> est appelé chaque fois que la fonction <code>window.electronAPI.quit()</code> du processus de rendu appelle <code>ipcRenderer.send()</code></p>
</li>
<li>
<p>Ajoutez la fonction <code>window.electronAPI.quit()</code> dans le processus de rendu</p>
<div class="highlight"><span class="filename">weather-renderer.js</span><pre><span></span><code><span class="hll"><span class="nb">window</span><span class="p">.</span><span class="nx">onbeforeunload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span class="hll"><span class="w">    </span><span class="nx">e</span><span class="p">.</span><span class="nx">returnValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
</span><span class="hll"><span class="w">    </span><span class="c1">// Calls window closure in the main process </span>
</span><span class="hll"><span class="w">    </span><span class="nb">window</span><span class="p">.</span><span class="nx">electronAPI</span><span class="p">.</span><span class="nx">quit</span><span class="p">();</span>
</span><span class="hll"><span class="p">}</span>
</span><span class="hll">
</span><span class="hll"><span class="c1">// A click on the label calls the &#39;beforeunload&#39; event</span>
</span><span class="hll"><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;quit&quot;</span><span class="p">).</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span class="hll"><span class="w">    </span><span class="nb">window</span><span class="p">.</span><span class="nx">dispatchEvent</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nx">Event</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;beforeunload&#39;</span><span class="p">));</span>
</span><span class="hll"><span class="p">})</span>
</span>
<span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">Lget</span><span class="w"> </span><span class="p">(</span><span class="nx">target</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nx">target</span><span class="p">];</span>
<span class="w">        </span><span class="nx">args</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">arg</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">target</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">arg</span><span class="p">);</span>
<span class="w">        </span><span class="p">})</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">electronAPI</span><span class="p">.</span><span class="nx">getMsg</span><span class="p">(</span><span class="nx">target</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">setElementLabel</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;quit&#39;</span><span class="p">).</span><span class="nx">innerHTML</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">Lget</span><span class="p">(</span><span class="s2">&quot;message.quit&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="nb">window</span><span class="p">.</span><span class="nx">electronAPI</span><span class="p">.</span><span class="nx">onInitWeather</span><span class="p">(</span><span class="w"> </span><span class="nx">_event</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">setElementLabel</span><span class="p">();</span><span class="w"> </span>
<span class="p">})</span>
</code></pre></div>
</li>
<li>
<p>Redémarrez A.V.A.T.A.R et vérifiez la fermeture de la fenêtre par un click de l'elément label <strong>X</strong></p>
</li>
</ol>
<h2 id="finalisation">Finalisation</h2>
<p>Quelques petits ajouts pour finaliser le plugin, par exemple :</p>
<ol>
<li>Que la taille de la fenêtre soient des paramètres</li>
<li>Que l'on puisse facilement ouvrir la console Chromium</li>
</ol>
<p><strong>1:</strong> Taille de la fenêtre en paramètres</p>
<ul>
<li>Ajoutez des propriétés pour le plugin par <em>Plugin studio</em></li>
</ul>
<div class="highlight"><pre><span></span><code><span class="err">wi</span><span class="kc">n</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="err">wid</span><span class="kc">t</span><span class="err">h</span><span class="p">:</span><span class="w"> </span><span class="mi">150</span><span class="p">,</span>
<span class="w">    </span><span class="err">heigh</span><span class="kc">t</span><span class="p">:</span><span class="w"> </span><span class="mi">320</span><span class="p">,</span>
<span class="w">    </span><span class="err">opaci</span><span class="kc">t</span><span class="err">y</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="p">}</span>
<span class="err">devTools</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="kc">false</span>
</code></pre></div>
<p><img alt="weather-new-properties" src="../img/weather-new-properties.png" width="400" /></p>
<p><strong>2:</strong> Modifiez l'objet <code>style</code> pour inclure les paramètres</p>
<div class="highlight"><span class="filename">weather.js</span><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="nx">style</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">parent</span><span class="o">:</span><span class="w"> </span><span class="nx">Avatar</span><span class="p">.</span><span class="nx">Interface</span><span class="p">.</span><span class="nx">mainWindow</span><span class="p">(),</span>
<span class="w">    </span><span class="nx">frame</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="nx">movable</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nx">resizable</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="nx">minimizable</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="nx">alwaysOnTop</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="nx">show</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="hll"><span class="w">    </span><span class="nx">width</span><span class="o">:</span><span class="w"> </span><span class="nx">Config</span><span class="p">.</span><span class="nx">modules</span><span class="p">.</span><span class="nx">weather</span><span class="p">.</span><span class="nx">win</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span>
</span><span class="hll"><span class="w">    </span><span class="nx">height</span><span class="o">:</span><span class="w"> </span><span class="nx">Config</span><span class="p">.</span><span class="nx">modules</span><span class="p">.</span><span class="nx">weather</span><span class="p">.</span><span class="nx">win</span><span class="p">.</span><span class="nx">height</span><span class="p">,</span>
</span><span class="hll"><span class="w">    </span><span class="nx">opacity</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">Config</span><span class="p">.</span><span class="nx">modules</span><span class="p">.</span><span class="nx">weather</span><span class="p">.</span><span class="nx">win</span><span class="p">.</span><span class="nx">opacity</span><span class="p">,</span>
</span><span class="w">    </span><span class="nx">icon</span><span class="o">:</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;assets&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;images&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;weather.png&#39;</span><span class="p">),</span>
<span class="w">    </span><span class="nx">webPreferences</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">preload</span><span class="o">:</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;weather-preload.js&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Weather forecast&quot;</span>
<span class="p">};</span>

<span class="p">......</span>
</code></pre></div>
<p><strong>3:</strong> Ajoutez l'ouverture de la console Chromium</p>
<div class="highlight"><span class="filename">weather.js</span><pre><span></span><code><span class="nx">WeatherWindow</span><span class="p">.</span><span class="nx">once</span><span class="p">(</span><span class="s1">&#39;ready-to-show&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">WeatherWindow</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span>
<span class="w">    </span><span class="nx">WeatherWindow</span><span class="p">.</span><span class="nx">webContents</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">&#39;onInit-weather&#39;</span><span class="p">);</span>
<span class="hll"><span class="w">    </span><span class="c1">// Displays the Chromium console if the devTools parameter is true</span>
</span><span class="hll"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">Config</span><span class="p">.</span><span class="nx">modules</span><span class="p">.</span><span class="nx">weather</span><span class="p">.</span><span class="nx">devTools</span><span class="p">)</span><span class="w"> </span><span class="nx">WeatherWindow</span><span class="p">.</span><span class="nx">webContents</span><span class="p">.</span><span class="nx">openDevTools</span><span class="p">();</span>
</span><span class="p">})</span>
</code></pre></div>
<ol>
<li>Redémarrez A.V.A.T.A.R</li>
</ol>
<p>Dans l'exemple suivant, nous allons tranférer ce plugin vers un client</p>
<p><br><br>
<a class="md-button" href="../meteo/" style="float:left;"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6 18V6h2v12H6m3.5-6L18 6v12l-8.5-6Z"/></svg></span> Créer un widget bouton - Part 1</a><a class="md-button" href="../meteo-widget-client/" style="float:right;">Tranférer le plugin vers un client - Part 3 <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16 18h2V6h-2M6 18l8.5-6L6 6v12Z"/></svg></span></a> <br />
<br><br></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      &copy; 2024 <a href="https://github.com" target="_blank" rel="noopener">A.V.A.T.A.R</a>

    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.top", "search.suggest", "search.highlight", "content.code.annotation", "content.code.copy", "content.tooltips"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.ad660dcc.min.js"></script>
      
    
  </body>
</html>